<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:i_am.ViewModels"
             xmlns:models="clr-namespace:i_am.Models"
             x:Class="i_am.Views.CheckInPage"
             x:DataType="vm:CheckInVM"
             Title="Codzienne pytania">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Pomoc" Command="{Binding SendHelpAlertCommand}" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="*,Auto">
        
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="20" Spacing="20">

                <Frame BackgroundColor="LightGreen" 
                       IsVisible="{Binding IsCheckInCompleted}"
                       Padding="15"
                       CornerRadius="10">
                    <Label Text="Dziekujemy! Dzisiejsze pytania zostaly juz wypelnione."
                           HorizontalTextAlignment="Center" />
                </Frame>

                <CollectionView ItemsSource="{Binding ClosedQuestions}"
                                IsVisible="{Binding IsCheckInCompleted, Converter={StaticResource InvertedBoolConverter}}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:Question">
                            <Frame Margin="0,0,0,10" Padding="15" CornerRadius="8">
                                <VerticalStackLayout Spacing="10">
                                    <Label Text="{Binding Text}" 
                                           FontSize="16"
                                           FontAttributes="Bold" />
                                    
                                    <CollectionView ItemsSource="{Binding Options}"
                                                    SelectionMode="Single"
                                                    SelectionChanged="OnAnswerSelected">
                                        <CollectionView.ItemTemplate>
                                            <DataTemplate x:DataType="models:AnswerOption">
                                                <RadioButton Content="{Binding Text}"
                                                             Value="{Binding .}"
                                                             GroupName="{Binding Source={RelativeSource AncestorType={x:Type models:Question}}, Path=Id}" />
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                    </CollectionView>
                                </VerticalStackLayout>
                            </Frame>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Frame Padding="15" 
                       CornerRadius="8"
                       IsVisible="{Binding OpenQuestion, Converter={StaticResource IsNotNullConverter}}">
                    <VerticalStackLayout Spacing="10">
                        <Label Text="{Binding OpenQuestion.Text}" 
                               FontSize="16"
                               FontAttributes="Bold" />
                        <Editor Text="{Binding OpenQuestionResponse}"
                                Placeholder="Wpisz swoja odpowiedz..."
                                HeightRequest="120"
                                IsEnabled="{Binding IsCheckInCompleted, Converter={StaticResource InvertedBoolConverter}}" />
                    </VerticalStackLayout>
                </Frame>

            </VerticalStackLayout>
        </ScrollView>

        <Button Grid.Row="1"
                Text="Wyslij odpowiedzi"
                Command="{Binding SubmitCheckInCommand}"
                IsEnabled="{Binding CanSubmit}"
                Margin="20"
                HeightRequest="50"
                FontSize="18" />

    </Grid>

</ContentPage>